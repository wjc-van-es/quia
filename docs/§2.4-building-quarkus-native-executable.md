<style>
body {
  font-family: "Gentium Basic", Cardo , "Linux Libertine o", "Palatino Linotype", Cambria, serif;
  font-size: 130% !important;
}
code {
	padding: 0 .25em;
	
	white-space: pre;
	font-family: "Tlwg mono", Consolas, "Liberation Mono", Menlo, Courier, monospace;
	
	background-color: #ECFFFA;
	//border: 1px solid #ccc;
	//border-radius: 3px;
}

kbd {
	display: inline-block;
	padding: 3px 5px;
	font-family: "Tlwg mono", Consolas, "Liberation Mono", Menlo, Courier, monospace;
	line-height: 10px;
	color: #555;
	vertical-align: middle;
	background-color: #ECFFFA;
	border: solid 1px #ccc;
	border-bottom-color: #bbb;
	border-radius: 3px;
	box-shadow: inset 0 -1px 0 #bbb;
}

h1,h2,h3,h4,h5 {
  color: #269B7D; 
  font-family: "fira sans", "Latin Modern Sans", Calibri, "Trebuchet MS", sans-serif;
}

</style>

# Building a Quarkus native executable with GraalVM / Mandrel

## Installing Mandrel with SDKMan!

### checking out available versions and installing a Java 21 version
```bash
willem@willem-Latitude-5590:~/git/quia$ sdk list java | grep mandrel
 Mandrel       |     | 24.1.r23     | mandrel |            | 24.1.r23-mandrel    
               |     | 24.0.2.r22   | mandrel |            | 24.0.2.r22-mandrel  
               |     | 23.1.4.r21   | mandrel |            | 23.1.4.r21-mandrel  
               |     | 23.0.5.r17   | mandrel |            | 23.0.5.r17-mandrel  
               |     | 22.3.5.r17   | mandrel |            | 22.3.5.r17-mandrel 
```
- I assume the r21 means a Java 21 JDK so we choose:
  `~/git/quia$ sdk install java 23.1.4.r21-mandrel`
- Then
  `~/git/quia$ sdk use java 23.1.4.r21-mandrel`
- `printenv GRAALVM_HOME` renders nothing, but the `PATH` points to the right dirs:
  ```bash
  ~/git/quia$ printenv PATH
  /home/willem/anaconda3/condabin:/home/willem/.sdkman/candidates/spark/current/bin:/home/willem/.sdkman/candidates/quarkus/current/bin:/home/willem/.sdkman/candidates/maven/current/bin:/home/willem/.sdkman/candidates/java/23.1.4.r21-mandrel/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/home/willem/.local/share/JetBrains/Toolbox/scripts
  ```
  
## Attempting to build a native executable with `mvn clean package -Pnative`

### The first attempt failed with the complaint
`Error: Default native-compiler executable 'gcc' not found via environment variable PATH`

<details>

```bash
willem@willem-Latitude-5590:~/git/quia$ mvn clean package -Pnative
[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------------------< nl.vea:quia >-----------------------------
[INFO] Building quia 1.0.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- clean:3.2.0:clean (default-clean) @ quia ---
[INFO] Deleting /home/willem/git/quia/target
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ quia ---
[INFO] Copying 2 resources from src/main/resources to target/classes
[INFO] 
[INFO] --- quarkus:3.14.1:generate-code (default) @ quia ---
[INFO] 
[INFO] --- compiler:3.13.0:compile (default-compile) @ quia ---
[INFO] Recompiling the module because of changed source code.
[INFO] Compiling 1 source file with javac [debug parameters release 21] to target/classes
[INFO] 
[INFO] --- quarkus:3.14.1:generate-code-tests (default) @ quia ---
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ quia ---
[INFO] skip non existing resourceDirectory /home/willem/git/quia/src/test/resources
[INFO] 
[INFO] --- compiler:3.13.0:testCompile (default-testCompile) @ quia ---
[INFO] Recompiling the module because of changed dependency.
[INFO] Compiling 2 source files with javac [debug parameters release 21] to target/test-classes
[INFO] 
[INFO] --- surefire:3.3.1:test (default-test) @ quia ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running nl.vea.GreetingResourceTest
2024-09-28 20:29:13,858 INFO  [io.quarkus] (main) quia 1.0.0-SNAPSHOT on JVM (powered by Quarkus 3.14.1) started in 2.910s. Listening on: http://localhost:8081
2024-09-28 20:29:13,862 INFO  [io.quarkus] (main) Profile test activated. 
2024-09-28 20:29:13,862 INFO  [io.quarkus] (main) Installed features: [cdi, rest, smallrye-context-propagation, vertx]
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 7.130 s -- in nl.vea.GreetingResourceTest
2024-09-28 20:29:15,332 INFO  [io.quarkus] (main) quia stopped in 0.042s
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] 
[INFO] --- jar:3.4.1:jar (default-jar) @ quia ---
[INFO] Building jar: /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT.jar
[INFO] 
[INFO] --- quarkus:3.14.1:build (default) @ quia ---
[INFO] [io.quarkus.deployment.pkg.steps.JarResultBuildStep] Building native image source jar: /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner.jar
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Building native image from /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner.jar
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Running Quarkus native-image plugin on MANDREL 23.1.4.0 JDK 21.0.4+7-LTS
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] /home/willem/.sdkman/candidates/java/23.1.4.r21-mandrel/bin/native-image -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Dlogging.initial-configurator.min-level=500 -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=3 -J-Duser.language=en -J-Duser.country=US -J-Dfile.encoding=UTF-8 --features=io.quarkus.runner.Feature,io.quarkus.runtime.graal.DisableLoggingFeature -J--add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED -J--add-exports=java.security.jgss/sun.security.jgss=ALL-UNNAMED -J--add-opens=java.base/java.text=ALL-UNNAMED -J--add-opens=java.base/java.io=ALL-UNNAMED -J--add-opens=java.base/java.lang.invoke=ALL-UNNAMED -J--add-opens=java.base/java.util=ALL-UNNAMED -H:+UnlockExperimentalVMOptions -H:BuildOutputJSONFile=quia-1.0.0-SNAPSHOT-runner-build-output-stats.json -H:-UnlockExperimentalVMOptions -H:+UnlockExperimentalVMOptions -H:+GenerateBuildArtifactsFile -H:-UnlockExperimentalVMOptions --strict-image-heap -H:+UnlockExperimentalVMOptions -H:+AllowFoldMethods -H:-UnlockExperimentalVMOptions -J-Djava.awt.headless=true --no-fallback --link-at-build-time -H:+UnlockExperimentalVMOptions -H:+ReportExceptionStackTraces -H:-UnlockExperimentalVMOptions -H:-AddAllCharsets --enable-url-protocols=http --enable-monitoring=heapdump -H:+UnlockExperimentalVMOptions -H:-UseServiceLoaderFeature -H:-UnlockExperimentalVMOptions -J--add-exports=org.graalvm.nativeimage/org.graalvm.nativeimage.impl=ALL-UNNAMED --exclude-config io\.netty\.netty-codec /META-INF/native-image/io\.netty/netty-codec/generated/handlers/reflect-config\.json --exclude-config io\.netty\.netty-handler /META-INF/native-image/io\.netty/netty-handler/generated/handlers/reflect-config\.json quia-1.0.0-SNAPSHOT-runner -jar quia-1.0.0-SNAPSHOT-runner.jar
========================================================================================================================
GraalVM Native Image: Generating 'quia-1.0.0-SNAPSHOT-runner' (executable)...
========================================================================================================================
[1/8] Initializing...
                                                                                    (0.0s @ 0.12GB)
Error: Default native-compiler executable 'gcc' not found via environment variable PATH
Error: To prevent native-toolchain checking provide command-line option -H:-CheckToolchain
com.oracle.svm.core.util.UserError$UserException: Default native-compiler executable 'gcc' not found via environment variable PATH
To prevent native-toolchain checking provide command-line option -H:-CheckToolchain
        at org.graalvm.nativeimage.builder/com.oracle.svm.core.util.UserError.abort(UserError.java:126)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.c.codegen.CCompilerInvoker.addSkipCheckingInfo(CCompilerInvoker.java:107)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.c.codegen.CCompilerInvoker.<init>(CCompilerInvoker.java:75)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.c.codegen.CCompilerInvoker$LinuxCCompilerInvoker.<init>(CCompilerInvoker.java:217)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.c.codegen.CCompilerInvoker.create(CCompilerInvoker.java:83)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.setupNativeImage(NativeImageGenerator.java:954)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:590)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.run(NativeImageGenerator.java:550)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:539)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:721)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.start(NativeImageGeneratorRunner.java:143)
        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.main(NativeImageGeneratorRunner.java:98)
------------------------------------------------------------------------------------------------------------------------
                        0.4s (9.3% of total time) in 16 GCs | Peak RSS: 0.46GB | CPU load: 5.24
========================================================================================================================
Finished generating 'quia-1.0.0-SNAPSHOT-runner' in 3.8s.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  23.160 s
[INFO] Finished at: 2024-09-28T20:29:24+02:00
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal io.quarkus.platform:quarkus-maven-plugin:3.14.1:build (default) on project quia: Failed to build quarkus application: io.quarkus.builder.BuildException: Build failure: Build failed due to errors
[ERROR]         [error]: Build step io.quarkus.deployment.pkg.steps.NativeImageBuildStep#build threw an exception: io.quarkus.deployment.pkg.steps.NativeImageBuildStep$ImageGenerationFailureException: Image generation failed. Exit code: 1
[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.imageGenerationFailed(NativeImageBuildStep.java:473)
[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.build(NativeImageBuildStep.java:262)
[ERROR]         at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
[ERROR]         at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:854)
[ERROR]         at io.quarkus.builder.BuildContext.run(BuildContext.java:256)
[ERROR]         at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)
[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2516)
[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2495)
[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1521)
[ERROR]         at java.base/java.lang.Thread.run(Thread.java:1583)
[ERROR]         at org.jboss.threads.JBossThread.run(JBossThread.java:483)
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException
willem@willem-Latitude-5590:~/git/quia$ 
```
</details>

### Solution install missing GCC, and the glibc and zlib headers.
- see [https://quarkus.io/guides/building-native-image#prerequisites](https://quarkus.io/guides/building-native-image#prerequisites)
- `sudo apt-get install build-essential libz-dev zlib1g-dev`

<details>

```bash
willem@willem-Latitude-5590:~/git/quia$
sudo apt-get install build-essential libz-dev zlib1g-dev
[sudo] password for willem:
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Note, selecting 'zlib1g-dev' instead of 'libz-dev'
The following additional packages will be installed:
binutils binutils-common binutils-x86-64-linux-gnu dpkg-dev fakeroot g++ g++-13 g++-13-x86-64-linux-gnu g++-x86-64-linux-gnu gcc gcc-13 gcc-13-x86-64-linux-gnu
gcc-x86-64-linux-gnu libalgorithm-diff-perl libalgorithm-diff-xs-perl libalgorithm-merge-perl libasan8 libbinutils libcc1-0 libctf-nobfd0 libctf0 libfakeroot libgcc-13-dev
libgprofng0 libhwasan0 libitm1 liblsan0 libquadmath0 libsframe1 libstdc++-13-dev libtsan2 libubsan1 lto-disabled-list make
Suggested packages:
binutils-doc gprofng-gui debian-keyring g++-multilib g++-13-multilib gcc-13-doc gcc-multilib autoconf automake libtool flex bison gcc-doc gcc-13-multilib gcc-13-locales
gdb-x86-64-linux-gnu libstdc++-13-doc make-doc
The following NEW packages will be installed:
binutils binutils-common binutils-x86-64-linux-gnu build-essential dpkg-dev fakeroot g++ g++-13 g++-13-x86-64-linux-gnu g++-x86-64-linux-gnu gcc gcc-13 gcc-13-x86-64-linux-gnu
gcc-x86-64-linux-gnu libalgorithm-diff-perl libalgorithm-diff-xs-perl libalgorithm-merge-perl libasan8 libbinutils libcc1-0 libctf-nobfd0 libctf0 libfakeroot libgcc-13-dev
libgprofng0 libhwasan0 libitm1 liblsan0 libquadmath0 libsframe1 libstdc++-13-dev libtsan2 libubsan1 lto-disabled-list make zlib1g-dev
0 upgraded, 36 newly installed, 0 to remove and 10 not upgraded.
Need to get 56,8 MB of archives.
After this operation, 208 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 binutils-common amd64 2.42-4ubuntu2 [239 kB]
Get:2 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libsframe1 amd64 2.42-4ubuntu2 [14,8 kB]
Get:3 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libbinutils amd64 2.42-4ubuntu2 [572 kB]
Get:4 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libctf-nobfd0 amd64 2.42-4ubuntu2 [97,1 kB]
Get:5 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libctf0 amd64 2.42-4ubuntu2 [94,5 kB]
Get:6 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libgprofng0 amd64 2.42-4ubuntu2 [851 kB]
Get:7 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 binutils-x86-64-linux-gnu amd64 2.42-4ubuntu2 [2.469 kB]
Get:8 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 binutils amd64 2.42-4ubuntu2 [18,0 kB]
Get:9 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libcc1-0 amd64 14-20240412-0ubuntu1 [47,7 kB]
Get:10 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libitm1 amd64 14-20240412-0ubuntu1 [28,9 kB]
Get:11 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libasan8 amd64 14-20240412-0ubuntu1 [3.024 kB]
Get:12 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 liblsan0 amd64 14-20240412-0ubuntu1 [1.313 kB]
Get:13 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libtsan2 amd64 14-20240412-0ubuntu1 [2.736 kB]
Get:14 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libubsan1 amd64 14-20240412-0ubuntu1 [1.175 kB]
Get:15 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libhwasan0 amd64 14-20240412-0ubuntu1 [1.632 kB]
Get:16 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libquadmath0 amd64 14-20240412-0ubuntu1 [153 kB]
Get:17 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libgcc-13-dev amd64 13.2.0-23ubuntu4 [2.688 kB]
Get:18 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 gcc-13-x86-64-linux-gnu amd64 13.2.0-23ubuntu4 [21,9 MB]
Get:19 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 gcc-13 amd64 13.2.0-23ubuntu4 [482 kB]
Get:20 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 gcc-x86-64-linux-gnu amd64 4:13.2.0-7ubuntu1 [1.212 B]
Get:21 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 gcc amd64 4:13.2.0-7ubuntu1 [5.018 B]
Get:22 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libstdc++-13-dev amd64 13.2.0-23ubuntu4 [2.399 kB]
Get:23 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 g++-13-x86-64-linux-gnu amd64 13.2.0-23ubuntu4 [12,5 MB]
Get:24 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 g++-13 amd64 13.2.0-23ubuntu4 [14,5 kB]
Get:25 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 g++-x86-64-linux-gnu amd64 4:13.2.0-7ubuntu1 [964 B]
Get:26 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 g++ amd64 4:13.2.0-7ubuntu1 [1.100 B]
Get:27 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 make amd64 4.3-4.1build2 [180 kB]
Get:28 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 lto-disabled-list all 47 [12,4 kB]
Get:29 https://ubuntu.mirror.wearetriple.com/archive noble-updates/main amd64 dpkg-dev all 1.22.6ubuntu6.1 [1.074 kB]
Get:30 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 build-essential amd64 12.10ubuntu1 [4.928 B]
Get:31 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libfakeroot amd64 1.33-1 [32,4 kB]
Get:32 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 fakeroot amd64 1.33-1 [67,2 kB]
Get:33 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libalgorithm-diff-perl all 1.201-1 [41,8 kB]
Get:34 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libalgorithm-diff-xs-perl amd64 0.04-8build3 [11,2 kB]
Get:35 https://ubuntu.mirror.wearetriple.com/archive noble/main amd64 libalgorithm-merge-perl all 0.08-5 [11,4 kB]
Get:36 https://ubuntu.mirror.wearetriple.com/archive noble-updates/main amd64 zlib1g-dev amd64 1:1.3.dfsg-3.1ubuntu2.1 [894 kB]
Fetched 56,8 MB in 4s (13,2 MB/s)    
Extracting templates from packages: 100%
Selecting previously unselected package binutils-common:amd64.
(Reading database ... 373291 files and directories currently installed.)
Preparing to unpack .../00-binutils-common_2.42-4ubuntu2_amd64.deb ...
Unpacking binutils-common:amd64 (2.42-4ubuntu2) ...
Selecting previously unselected package libsframe1:amd64.
Preparing to unpack .../01-libsframe1_2.42-4ubuntu2_amd64.deb ...
Unpacking libsframe1:amd64 (2.42-4ubuntu2) ...
Selecting previously unselected package libbinutils:amd64.
Preparing to unpack .../02-libbinutils_2.42-4ubuntu2_amd64.deb ...
Unpacking libbinutils:amd64 (2.42-4ubuntu2) ...
Selecting previously unselected package libctf-nobfd0:amd64.
Preparing to unpack .../03-libctf-nobfd0_2.42-4ubuntu2_amd64.deb ...
Unpacking libctf-nobfd0:amd64 (2.42-4ubuntu2) ...
Selecting previously unselected package libctf0:amd64.
Preparing to unpack .../04-libctf0_2.42-4ubuntu2_amd64.deb ...
Unpacking libctf0:amd64 (2.42-4ubuntu2) ...
Selecting previously unselected package libgprofng0:amd64.
Preparing to unpack .../05-libgprofng0_2.42-4ubuntu2_amd64.deb ...
Unpacking libgprofng0:amd64 (2.42-4ubuntu2) ...
Selecting previously unselected package binutils-x86-64-linux-gnu.
Preparing to unpack .../06-binutils-x86-64-linux-gnu_2.42-4ubuntu2_amd64.deb ...
Unpacking binutils-x86-64-linux-gnu (2.42-4ubuntu2) ...
Selecting previously unselected package binutils.
Preparing to unpack .../07-binutils_2.42-4ubuntu2_amd64.deb ...
Unpacking binutils (2.42-4ubuntu2) ...
Selecting previously unselected package libcc1-0:amd64.
Preparing to unpack .../08-libcc1-0_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libcc1-0:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libitm1:amd64.
Preparing to unpack .../09-libitm1_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libitm1:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libasan8:amd64.
Preparing to unpack .../10-libasan8_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libasan8:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package liblsan0:amd64.
Preparing to unpack .../11-liblsan0_14-20240412-0ubuntu1_amd64.deb ...
Unpacking liblsan0:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libtsan2:amd64.
Preparing to unpack .../12-libtsan2_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libtsan2:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libubsan1:amd64.
Preparing to unpack .../13-libubsan1_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libubsan1:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libhwasan0:amd64.
Preparing to unpack .../14-libhwasan0_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libhwasan0:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libquadmath0:amd64.
Preparing to unpack .../15-libquadmath0_14-20240412-0ubuntu1_amd64.deb ...
Unpacking libquadmath0:amd64 (14-20240412-0ubuntu1) ...
Selecting previously unselected package libgcc-13-dev:amd64.
Preparing to unpack .../16-libgcc-13-dev_13.2.0-23ubuntu4_amd64.deb ...
Unpacking libgcc-13-dev:amd64 (13.2.0-23ubuntu4) ...
Selecting previously unselected package gcc-13-x86-64-linux-gnu.
Preparing to unpack .../17-gcc-13-x86-64-linux-gnu_13.2.0-23ubuntu4_amd64.deb ...
Unpacking gcc-13-x86-64-linux-gnu (13.2.0-23ubuntu4) ...
Selecting previously unselected package gcc-13.
Preparing to unpack .../18-gcc-13_13.2.0-23ubuntu4_amd64.deb ...
Unpacking gcc-13 (13.2.0-23ubuntu4) ...
Selecting previously unselected package gcc-x86-64-linux-gnu.
Preparing to unpack .../19-gcc-x86-64-linux-gnu_4%3a13.2.0-7ubuntu1_amd64.deb ...
Unpacking gcc-x86-64-linux-gnu (4:13.2.0-7ubuntu1) ...
Selecting previously unselected package gcc.
Preparing to unpack .../20-gcc_4%3a13.2.0-7ubuntu1_amd64.deb ...
Unpacking gcc (4:13.2.0-7ubuntu1) ...
Selecting previously unselected package libstdc++-13-dev:amd64.
Preparing to unpack .../21-libstdc++-13-dev_13.2.0-23ubuntu4_amd64.deb ...
Unpacking libstdc++-13-dev:amd64 (13.2.0-23ubuntu4) ...
Selecting previously unselected package g++-13-x86-64-linux-gnu.
Preparing to unpack .../22-g++-13-x86-64-linux-gnu_13.2.0-23ubuntu4_amd64.deb ...
Unpacking g++-13-x86-64-linux-gnu (13.2.0-23ubuntu4) ...
Selecting previously unselected package g++-13.
Preparing to unpack .../23-g++-13_13.2.0-23ubuntu4_amd64.deb ...
Unpacking g++-13 (13.2.0-23ubuntu4) ...
Selecting previously unselected package g++-x86-64-linux-gnu.
Preparing to unpack .../24-g++-x86-64-linux-gnu_4%3a13.2.0-7ubuntu1_amd64.deb ...
Unpacking g++-x86-64-linux-gnu (4:13.2.0-7ubuntu1) ...
Selecting previously unselected package g++.
Preparing to unpack .../25-g++_4%3a13.2.0-7ubuntu1_amd64.deb ...
Unpacking g++ (4:13.2.0-7ubuntu1) ...
Selecting previously unselected package make.
Preparing to unpack .../26-make_4.3-4.1build2_amd64.deb ...
Unpacking make (4.3-4.1build2) ...
Selecting previously unselected package lto-disabled-list.
Preparing to unpack .../27-lto-disabled-list_47_all.deb ...
Unpacking lto-disabled-list (47) ...
Selecting previously unselected package dpkg-dev.
Preparing to unpack .../28-dpkg-dev_1.22.6ubuntu6.1_all.deb ...
Unpacking dpkg-dev (1.22.6ubuntu6.1) ...
Selecting previously unselected package build-essential.
Preparing to unpack .../29-build-essential_12.10ubuntu1_amd64.deb ...
Unpacking build-essential (12.10ubuntu1) ...
Selecting previously unselected package libfakeroot:amd64.
Preparing to unpack .../30-libfakeroot_1.33-1_amd64.deb ...
Unpacking libfakeroot:amd64 (1.33-1) ...
Selecting previously unselected package fakeroot.
Preparing to unpack .../31-fakeroot_1.33-1_amd64.deb ...
Unpacking fakeroot (1.33-1) ...
Selecting previously unselected package libalgorithm-diff-perl.
Preparing to unpack .../32-libalgorithm-diff-perl_1.201-1_all.deb ...
Unpacking libalgorithm-diff-perl (1.201-1) ...
Selecting previously unselected package libalgorithm-diff-xs-perl:amd64.
Preparing to unpack .../33-libalgorithm-diff-xs-perl_0.04-8build3_amd64.deb ...
Unpacking libalgorithm-diff-xs-perl:amd64 (0.04-8build3) ...
Selecting previously unselected package libalgorithm-merge-perl.
Preparing to unpack .../34-libalgorithm-merge-perl_0.08-5_all.deb ...
Unpacking libalgorithm-merge-perl (0.08-5) ...
Selecting previously unselected package zlib1g-dev:amd64.
Preparing to unpack .../35-zlib1g-dev_1%3a1.3.dfsg-3.1ubuntu2.1_amd64.deb ...
Unpacking zlib1g-dev:amd64 (1:1.3.dfsg-3.1ubuntu2.1) ...
Setting up lto-disabled-list (47) ...
Setting up libalgorithm-diff-perl (1.201-1) ...
Setting up binutils-common:amd64 (2.42-4ubuntu2) ...
Setting up libctf-nobfd0:amd64 (2.42-4ubuntu2) ...
Setting up libsframe1:amd64 (2.42-4ubuntu2) ...
Setting up libfakeroot:amd64 (1.33-1) ...
Setting up fakeroot (1.33-1) ...
update-alternatives: using /usr/bin/fakeroot-sysv to provide /usr/bin/fakeroot (fakeroot) in auto mode
Setting up make (4.3-4.1build2) ...
Setting up libquadmath0:amd64 (14-20240412-0ubuntu1) ...
Setting up libubsan1:amd64 (14-20240412-0ubuntu1) ...
Setting up zlib1g-dev:amd64 (1:1.3.dfsg-3.1ubuntu2.1) ...
Setting up libhwasan0:amd64 (14-20240412-0ubuntu1) ...
Setting up libasan8:amd64 (14-20240412-0ubuntu1) ...
Setting up libtsan2:amd64 (14-20240412-0ubuntu1) ...
Setting up libbinutils:amd64 (2.42-4ubuntu2) ...
Setting up libalgorithm-diff-xs-perl:amd64 (0.04-8build3) ...
Setting up libcc1-0:amd64 (14-20240412-0ubuntu1) ...
Setting up liblsan0:amd64 (14-20240412-0ubuntu1) ...
Setting up libitm1:amd64 (14-20240412-0ubuntu1) ...
Setting up libalgorithm-merge-perl (0.08-5) ...
Setting up libctf0:amd64 (2.42-4ubuntu2) ...
Setting up libgprofng0:amd64 (2.42-4ubuntu2) ...
Setting up libgcc-13-dev:amd64 (13.2.0-23ubuntu4) ...
Setting up libstdc++-13-dev:amd64 (13.2.0-23ubuntu4) ...
Setting up binutils-x86-64-linux-gnu (2.42-4ubuntu2) ...
Setting up gcc-13-x86-64-linux-gnu (13.2.0-23ubuntu4) ...
Setting up binutils (2.42-4ubuntu2) ...
Setting up dpkg-dev (1.22.6ubuntu6.1) ...
Setting up gcc-13 (13.2.0-23ubuntu4) ...
Setting up g++-13-x86-64-linux-gnu (13.2.0-23ubuntu4) ...
Setting up gcc-x86-64-linux-gnu (4:13.2.0-7ubuntu1) ...
Setting up gcc (4:13.2.0-7ubuntu1) ...
Setting up g++-x86-64-linux-gnu (4:13.2.0-7ubuntu1) ...
Setting up g++-13 (13.2.0-23ubuntu4) ...
Setting up g++ (4:13.2.0-7ubuntu1) ...
update-alternatives: using /usr/bin/g++ to provide /usr/bin/c++ (c++) in auto mode
Setting up build-essential (12.10ubuntu1) ...
Processing triggers for man-db (2.12.0-4build2) ...
Processing triggers for libc-bin (2.39-0ubuntu8.3) ...
willem@willem-Latitude-5590:~/git/quia$
```

</details>

### second build attempt with `mvn clean package -Pnative`

<details>

```bash
willem@willem-Latitude-5590:~/git/quia$ mvn clean package -Pnative
[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------------------< nl.vea:quia >-----------------------------
[INFO] Building quia 1.0.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- clean:3.2.0:clean (default-clean) @ quia ---
[INFO] Deleting /home/willem/git/quia/target
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ quia ---
[INFO] Copying 2 resources from src/main/resources to target/classes
[INFO] 
[INFO] --- quarkus:3.14.1:generate-code (default) @ quia ---
[INFO] 
[INFO] --- compiler:3.13.0:compile (default-compile) @ quia ---
[INFO] Recompiling the module because of changed source code.
[INFO] Compiling 1 source file with javac [debug parameters release 21] to target/classes
[INFO] 
[INFO] --- quarkus:3.14.1:generate-code-tests (default) @ quia ---
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ quia ---
[INFO] skip non existing resourceDirectory /home/willem/git/quia/src/test/resources
[INFO] 
[INFO] --- compiler:3.13.0:testCompile (default-testCompile) @ quia ---
[INFO] Recompiling the module because of changed dependency.
[INFO] Compiling 2 source files with javac [debug parameters release 21] to target/test-classes
[INFO] 
[INFO] --- surefire:3.3.1:test (default-test) @ quia ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running nl.vea.GreetingResourceTest
2024-09-28 20:43:15,872 INFO  [io.quarkus] (main) quia 1.0.0-SNAPSHOT on JVM (powered by Quarkus 3.14.1) started in 2.704s. Listening on: http://localhost:8081
2024-09-28 20:43:15,874 INFO  [io.quarkus] (main) Profile test activated. 
2024-09-28 20:43:15,875 INFO  [io.quarkus] (main) Installed features: [cdi, rest, smallrye-context-propagation, vertx]
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 6.882 s -- in nl.vea.GreetingResourceTest
2024-09-28 20:43:17,373 INFO  [io.quarkus] (main) quia stopped in 0.054s
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] 
[INFO] --- jar:3.4.1:jar (default-jar) @ quia ---
[INFO] Building jar: /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT.jar
[INFO] 
[INFO] --- quarkus:3.14.1:build (default) @ quia ---
[INFO] [io.quarkus.deployment.pkg.steps.JarResultBuildStep] Building native image source jar: /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner.jar
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Building native image from /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner.jar
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Running Quarkus native-image plugin on MANDREL 23.1.4.0 JDK 21.0.4+7-LTS
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] /home/willem/.sdkman/candidates/java/23.1.4.r21-mandrel/bin/native-image -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Dlogging.initial-configurator.min-level=500 -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=3 -J-Duser.language=en -J-Duser.country=US -J-Dfile.encoding=UTF-8 --features=io.quarkus.runner.Feature,io.quarkus.runtime.graal.DisableLoggingFeature -J--add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED -J--add-exports=java.security.jgss/sun.security.jgss=ALL-UNNAMED -J--add-opens=java.base/java.text=ALL-UNNAMED -J--add-opens=java.base/java.io=ALL-UNNAMED -J--add-opens=java.base/java.lang.invoke=ALL-UNNAMED -J--add-opens=java.base/java.util=ALL-UNNAMED -H:+UnlockExperimentalVMOptions -H:BuildOutputJSONFile=quia-1.0.0-SNAPSHOT-runner-build-output-stats.json -H:-UnlockExperimentalVMOptions -H:+UnlockExperimentalVMOptions -H:+GenerateBuildArtifactsFile -H:-UnlockExperimentalVMOptions --strict-image-heap -H:+UnlockExperimentalVMOptions -H:+AllowFoldMethods -H:-UnlockExperimentalVMOptions -J-Djava.awt.headless=true --no-fallback --link-at-build-time -H:+UnlockExperimentalVMOptions -H:+ReportExceptionStackTraces -H:-UnlockExperimentalVMOptions -H:-AddAllCharsets --enable-url-protocols=http -H:NativeLinkerOption=-no-pie --enable-monitoring=heapdump -H:+UnlockExperimentalVMOptions -H:-UseServiceLoaderFeature -H:-UnlockExperimentalVMOptions -J--add-exports=org.graalvm.nativeimage/org.graalvm.nativeimage.impl=ALL-UNNAMED --exclude-config io\.netty\.netty-codec /META-INF/native-image/io\.netty/netty-codec/generated/handlers/reflect-config\.json --exclude-config io\.netty\.netty-handler /META-INF/native-image/io\.netty/netty-handler/generated/handlers/reflect-config\.json quia-1.0.0-SNAPSHOT-runner -jar quia-1.0.0-SNAPSHOT-runner.jar
========================================================================================================================
GraalVM Native Image: Generating 'quia-1.0.0-SNAPSHOT-runner' (executable)...
========================================================================================================================
[1/8] Initializing...                                                                                    (6.8s @ 0.14GB)
 Java version: 21.0.4+7-LTS, vendor version: Mandrel-23.1.4.0-Final
 Graal compiler: optimization level: 2, target machine: x86-64-v3
 C compiler: gcc (linux, x86_64, 13.2.0)
 Garbage collector: Serial GC (max heap size: 80% of RAM)
 3 user-specific feature(s):
 - com.oracle.svm.thirdparty.gson.GsonFeature
 - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions
 - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase
------------------------------------------------------------------------------------------------------------------------
 4 experimental option(s) unlocked:
 - '-H:+AllowFoldMethods' (origin(s): command line)
 - '-H:BuildOutputJSONFile' (origin(s): command line)
 - '-H:-UseServiceLoaderFeature' (origin(s): command line)
 - '-H:+GenerateBuildArtifactsFile' (origin(s): command line)
------------------------------------------------------------------------------------------------------------------------
Build resources:
 - 11.70GB of memory (75.6% of 15.48GB system memory, determined at start)
 - 8 thread(s) (100.0% of 8 available processor(s), determined at start)
[2/8] Performing analysis...  [******]                                                                  (42.1s @ 1.06GB)
   10,968 reachable types   (86.0% of   12,748 total)
   15,768 reachable fields  (55.8% of   28,246 total)
   55,543 reachable methods (56.2% of   98,882 total)
    3,545 types,   115 fields, and 3,128 methods registered for reflection
       62 types,    67 fields, and    55 methods registered for JNI access
        4 native libraries: dl, pthread, rt, z
[3/8] Building universe...                                                                               (6.1s @ 1.22GB)
[4/8] Parsing methods...      [***]                                                                      (5.2s @ 0.66GB)
[5/8] Inlining methods...     [***]                                                                      (2.7s @ 0.75GB)
[6/8] Compiling methods...    [******]                                                                  (40.2s @ 0.93GB)
[7/8] Layouting methods...    [**]                                                                       (4.7s @ 1.22GB)
[8/8] Creating image...       [***]                                                                      (6.2s @ 1.40GB)
  22.47MB (46.12%) for code area:    35,334 compilation units
  25.86MB (53.08%) for image heap:  297,477 objects and 57 resources
 400.39kB ( 0.80%) for other data
  48.72MB in total
------------------------------------------------------------------------------------------------------------------------
Top 10 origins of code area:                                Top 10 object types in image heap:
  12.47MB java.base                                            7.12MB byte[] for code metadata
   1.28MB svm.jar (Native Image)                               3.88MB byte[] for java.lang.String
   1.10MB quia-1.0.0-SNAPSHOT-runner.jar                       2.69MB java.lang.String
 962.52kB modified-io.vertx.vertx-core-4.5.9.jar               2.69MB java.lang.Class
 569.18kB io.netty.netty-buffer-4.1.111.Final.jar              1.02MB byte[] for general heap data
 503.46kB io.netty.netty-common-4.1.111.Final.jar            942.56kB com.oracle.svm.core.hub.DynamicHubCompanion
 420.36kB io.netty.netty-codec-http-4.1.111.Final.jar        630.11kB byte[] for reflection metadata
 387.81kB io.netty.netty-codec-http2-4.1.111.Final.jar       527.88kB java.lang.String[]
 378.16kB io.netty.netty-transport-4.1.111.Final.jar         465.03kB heap alignment
 370.77kB io.smallrye.config.smallrye-config-core-3.9.1.jar  453.70kB java.util.HashMap$Node
   3.86MB for 76 more packages                                 5.52MB for 2725 more object types
------------------------------------------------------------------------------------------------------------------------
Recommendations:
 HEAP: Set max heap for improved and more predictable memory usage.
 CPU:  Enable more CPU features with '-march=native' for improved performance.
------------------------------------------------------------------------------------------------------------------------
                       9.7s (8.4% of total time) in 1344 GCs | Peak RSS: 2.04GB | CPU load: 6.68
------------------------------------------------------------------------------------------------------------------------
Produced artifacts:
 /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/build-artifacts.json (build_info)
 /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner (executable)
 /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner-build-output-stats.json (build_info)
========================================================================================================================
Finished generating 'quia-1.0.0-SNAPSHOT-runner' in 1m 55s.
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] objcopy --strip-debug quia-1.0.0-SNAPSHOT-runner
[INFO] [io.quarkus.deployment.QuarkusAugmentor] Quarkus augmentation completed in 120344ms
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  02:14 min
[INFO] Finished at: 2024-09-28T20:45:19+02:00
[INFO] ------------------------------------------------------------------------
willem@willem-Latitude-5590:~/git/quia$ 
```

</details>

We see the native executable we can run next at `target/quia-1.0.0-SNAPSHOT-runner`

## Running the native executable with `~/git/quia$ ./target/quia-1.0.0-SNAPSHOT-runner`
This starts up extremely fast (as opposed to the time it takes to create the build)
<details>

```bash
willem@willem-Latitude-5590:~/git/quia$ ./target/quia-1.0.0-SNAPSHOT-runner 
__  ____  __  _____   ___  __ ____  ______ 
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/ 
 -/ /_/ / /_/ / __ |/ , _/ ,< / /_/ /\ \   
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/   
2024-09-28 21:30:13,269 INFO  [io.quarkus] (main) quia 1.0.0-SNAPSHOT native (powered by Quarkus 3.14.1) started in 0.035s. Listening on: http://0.0.0.0:8080
2024-09-28 21:30:13,269 INFO  [io.quarkus] (main) Profile prod activated. 
2024-09-28 21:30:13,269 INFO  [io.quarkus] (main) Installed features: [cdi, rest, smallrye-context-propagation, vertx]


```

</details>

In the HTTP response output of [http://localhost:8080/hello](http://localhost:8080/hello) we can see it's running on
`Java 21.0.4 of Mandrel-23.1.4.0-Final of GraalVM Community`.

<details>

---

<h1>Hello willem,</h1>
<h2>welcome to Quarkus REST</h2>
<h2>The current time is 2024-09-28T21:30:49.346186</h2>
<p>Running with Java 21.0.4, Mandrel-23.1.4.0-Final of GraalVM Community at null.</p>
<p>OS/Arch/version: Linux/amd64/6.8.0-45-generic</p>

---

</details>

We quit the service with `Ctrl+C`

## Building the native executable using Docker images with `mvn clean package -Pnative -Dquarkus.native.container-build=true`
- When we have Docker (or Podman) installed on our computer, we can use container images to create a native executable.
- For this to work we don't use the GraalVM / Mandrel installation.
- This will create a linux compatible native executable that can only run on a linux environment so either
  - your computer host when it is a linux installation, or
  - inside a linux based Docker / Podman container

<details>

```bash
willem@willem-Latitude-5590:~/git/quia$ mvn clean package -Pnative -Dquarkus.native.container-build=true
[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------------------< nl.vea:quia >-----------------------------
[INFO] Building quia 1.0.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- clean:3.2.0:clean (default-clean) @ quia ---
[INFO] Deleting /home/willem/git/quia/target
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ quia ---
[INFO] Copying 2 resources from src/main/resources to target/classes
[INFO] 
[INFO] --- quarkus:3.14.1:generate-code (default) @ quia ---
[INFO] 
[INFO] --- compiler:3.13.0:compile (default-compile) @ quia ---
[INFO] Recompiling the module because of changed source code.
[INFO] Compiling 1 source file with javac [debug parameters release 21] to target/classes
[INFO] 
[INFO] --- quarkus:3.14.1:generate-code-tests (default) @ quia ---
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ quia ---
[INFO] skip non existing resourceDirectory /home/willem/git/quia/src/test/resources
[INFO] 
[INFO] --- compiler:3.13.0:testCompile (default-testCompile) @ quia ---
[INFO] Recompiling the module because of changed dependency.
[INFO] Compiling 2 source files with javac [debug parameters release 21] to target/test-classes
[INFO] 
[INFO] --- surefire:3.3.1:test (default-test) @ quia ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running nl.vea.GreetingResourceTest
2024-09-28 22:15:34,546 INFO  [io.quarkus] (main) quia 1.0.0-SNAPSHOT on JVM (powered by Quarkus 3.14.1) started in 3.411s. Listening on: http://localhost:8081
2024-09-28 22:15:34,548 INFO  [io.quarkus] (main) Profile test activated. 
2024-09-28 22:15:34,549 INFO  [io.quarkus] (main) Installed features: [cdi, rest, smallrye-context-propagation, vertx]
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 7.648 s -- in nl.vea.GreetingResourceTest
2024-09-28 22:15:35,937 INFO  [io.quarkus] (main) quia stopped in 0.036s
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] 
[INFO] --- jar:3.4.1:jar (default-jar) @ quia ---
[INFO] Building jar: /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT.jar
[INFO] 
[INFO] --- quarkus:3.14.1:build (default) @ quia ---
[INFO] [io.quarkus.deployment.pkg.steps.JarResultBuildStep] Building native image source jar: /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner.jar
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Building native image from /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar/quia-1.0.0-SNAPSHOT-runner.jar
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner] Using docker to run the native image builder
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildContainerRunner] Pulling builder image 'quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21'
jdk-21: Pulling from quarkus/ubi-quarkus-mandrel-builder-image
56f27190e824: Pulling fs layer 
b311125ba299: Pulling fs layer 
958fffd9a1c2: Pull complete 
d48bcea41383: Pull complete 
0a3cc83528e2: Pull complete 
a42b59d8cbd1: Pull complete 
dc4855bb7667: Pull complete 
615d031c23fe: Pull complete 
3a927907c301: Pull complete 
0518694fe245: Pull complete 
752eb62f4c5d: Pull complete 
2cab6213e962: Pull complete 
397483d2f898: Pull complete 
4f4fb700ef54: Pull complete 
Digest: sha256:19c266590abc6f2dbc5087c4c57d7d539a746123d15ad6d6301d09e5813f8c47
Status: Downloaded newer image for quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21
quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Running Quarkus native-image plugin on MANDREL 23.1.4.0 JDK 21.0.4+7-LTS
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] docker run --env LANG=C --rm --user 1000:1000 -v /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar:/project:z --name build-native-yMEfk quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21 -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Dlogging.initial-configurator.min-level=500 -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=3 -J-Duser.language=en -J-Duser.country=US -J-Dfile.encoding=UTF-8 --features=io.quarkus.runner.Feature,io.quarkus.runtime.graal.DisableLoggingFeature -J--add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED -J--add-exports=java.security.jgss/sun.security.jgss=ALL-UNNAMED -J--add-opens=java.base/java.text=ALL-UNNAMED -J--add-opens=java.base/java.io=ALL-UNNAMED -J--add-opens=java.base/java.lang.invoke=ALL-UNNAMED -J--add-opens=java.base/java.util=ALL-UNNAMED -H:+UnlockExperimentalVMOptions -H:BuildOutputJSONFile=quia-1.0.0-SNAPSHOT-runner-build-output-stats.json -H:-UnlockExperimentalVMOptions -H:+UnlockExperimentalVMOptions -H:+GenerateBuildArtifactsFile -H:-UnlockExperimentalVMOptions --strict-image-heap -H:+UnlockExperimentalVMOptions -H:+AllowFoldMethods -H:-UnlockExperimentalVMOptions -J-Djava.awt.headless=true --no-fallback --link-at-build-time -H:+UnlockExperimentalVMOptions -H:+ReportExceptionStackTraces -H:-UnlockExperimentalVMOptions -H:-AddAllCharsets --enable-url-protocols=http --enable-monitoring=heapdump -H:+UnlockExperimentalVMOptions -H:-UseServiceLoaderFeature -H:-UnlockExperimentalVMOptions -J--add-exports=org.graalvm.nativeimage/org.graalvm.nativeimage.impl=ALL-UNNAMED --exclude-config io\.netty\.netty-codec /META-INF/native-image/io\.netty/netty-codec/generated/handlers/reflect-config\.json --exclude-config io\.netty\.netty-handler /META-INF/native-image/io\.netty/netty-handler/generated/handlers/reflect-config\.json quia-1.0.0-SNAPSHOT-runner -jar quia-1.0.0-SNAPSHOT-runner.jar
========================================================================================================================
GraalVM Native Image: Generating 'quia-1.0.0-SNAPSHOT-runner' (executable)...
========================================================================================================================
For detailed information and explanations on the build output, visit:
https://github.com/oracle/graal/blob/master/docs/reference-manual/native-image/BuildOutput.md
------------------------------------------------------------------------------------------------------------------------
[1/8] Initializing...                                                                                    (6.8s @ 0.13GB)
 Java version: 21.0.4+7-LTS, vendor version: Mandrel-23.1.4.0-Final
 Graal compiler: optimization level: 2, target machine: x86-64-v3
 C compiler: gcc (redhat, x86_64, 8.5.0)
 Garbage collector: Serial GC (max heap size: 80% of RAM)
 3 user-specific feature(s):
 - com.oracle.svm.thirdparty.gson.GsonFeature
 - io.quarkus.runner.Feature: Auto-generated class by Quarkus from the existing extensions
 - io.quarkus.runtime.graal.DisableLoggingFeature: Disables INFO logging during the analysis phase
------------------------------------------------------------------------------------------------------------------------
 4 experimental option(s) unlocked:
 - '-H:+AllowFoldMethods' (origin(s): command line)
 - '-H:BuildOutputJSONFile' (origin(s): command line)
 - '-H:-UseServiceLoaderFeature' (origin(s): command line)
 - '-H:+GenerateBuildArtifactsFile' (origin(s): command line)
------------------------------------------------------------------------------------------------------------------------
Build resources:
 - 11.70GB of memory (75.6% of 15.48GB system memory, determined at start)
 - 8 thread(s) (100.0% of 8 available processor(s), determined at start)
[2/8] Performing analysis...  [******]                                                                  (42.7s @ 1.06GB)
   10,968 reachable types   (86.0% of   12,748 total)
   15,767 reachable fields  (55.9% of   28,220 total)
   55,531 reachable methods (56.2% of   98,880 total)
    3,545 types,   115 fields, and 3,128 methods registered for reflection
       62 types,    67 fields, and    55 methods registered for JNI access
        4 native libraries: dl, pthread, rt, z
[3/8] Building universe...                                                                               (5.8s @ 1.22GB)
[4/8] Parsing methods...      [***]                                                                      (5.1s @ 1.34GB)
[5/8] Inlining methods...     [***]                                                                      (3.1s @ 1.43GB)
[6/8] Compiling methods...    [*******]                                                                 (47.3s @ 1.04GB)
[7/8] Layouting methods...    [***]                                                                      (7.2s @ 0.94GB)
[8/8] Creating image...       [***]                                                                      (6.3s @ 1.08GB)
  22.47MB (46.12%) for code area:    35,320 compilation units
  25.86MB (53.07%) for image heap:  297,097 objects and 57 resources
 407.08kB ( 0.82%) for other data
  48.72MB in total
------------------------------------------------------------------------------------------------------------------------
Top 10 origins of code area:                                Top 10 object types in image heap:
  12.47MB java.base                                            7.12MB byte[] for code metadata
   1.28MB svm.jar (Native Image)                               3.88MB byte[] for java.lang.String
   1.10MB quia-1.0.0-SNAPSHOT-runner.jar                       2.69MB java.lang.String
 962.52kB modified-io.vertx.vertx-core-4.5.9.jar               2.69MB java.lang.Class
 569.18kB io.netty.netty-buffer-4.1.111.Final.jar              1.02MB byte[] for general heap data
 503.39kB io.netty.netty-common-4.1.111.Final.jar            942.56kB com.oracle.svm.core.hub.DynamicHubCompanion
 420.36kB io.netty.netty-codec-http-4.1.111.Final.jar        630.04kB byte[] for reflection metadata
 387.81kB io.netty.netty-codec-http2-4.1.111.Final.jar       527.85kB java.lang.String[]
 378.16kB io.netty.netty-transport-4.1.111.Final.jar         480.72kB heap alignment
 370.77kB io.smallrye.config.smallrye-config-core-3.9.1.jar  453.19kB java.util.HashMap$Node
   3.86MB for 76 more packages                                 5.50MB for 2722 more object types
------------------------------------------------------------------------------------------------------------------------
Recommendations:
 HEAP: Set max heap for improved and more predictable memory usage.
 CPU:  Enable more CPU features with '-march=native' for improved performance.
------------------------------------------------------------------------------------------------------------------------
                       10.3s (8.1% of total time) in 1453 GCs | Peak RSS: 2.06GB | CPU load: 6.47
------------------------------------------------------------------------------------------------------------------------
Produced artifacts:
 /project/build-artifacts.json (build_info)
 /project/quia-1.0.0-SNAPSHOT-runner (executable)
 /project/quia-1.0.0-SNAPSHOT-runner-build-output-stats.json (build_info)
========================================================================================================================
Finished generating 'quia-1.0.0-SNAPSHOT-runner' in 2m 5s.
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] docker run --env LANG=C --rm --user 1000:1000 -v /home/willem/git/quia/target/quia-1.0.0-SNAPSHOT-native-image-source-jar:/project:z --entrypoint /bin/bash quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21 -c objcopy --strip-debug quia-1.0.0-SNAPSHOT-runner
[INFO] [io.quarkus.deployment.QuarkusAugmentor] Quarkus augmentation completed in 186395ms
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  03:21 min
[INFO] Finished at: 2024-09-28T22:18:43+02:00
[INFO] ------------------------------------------------------------------------
willem@willem-Latitude-5590:~/git/quia$ 
```

</details>

- I was wondering if a Java 21 builder image would be pulled or an older Java 17 one, but the output above clearly
  reveals: `Status: Downloaded newer image for quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21
quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21`
- This is confirmed with a `docker image list` check:
  ```bash
  REPOSITORY                                          TAG              IMAGE ID       CREATED        SIZE
  quay.io/quarkus/ubi-quarkus-mandrel-builder-image   jdk-21           3c8cb374a987   5 days ago     1.17GB
  ```
- `~/git/quia$ ls -la target` reveals a fresh set of build artifacts
- Running the native executable with `~/git/quia$ ./target/quia-1.0.0-SNAPSHOT-runner`